#include "intstack.h"
//data
char t_col[21][10]={"int",  //0
                    "main",//1
                    "begin",//2
                    "end",//3
                    ";",//4
                    "id",//5
                    "[",//6
                    "]",//7
                    "number",//8
                    "=",//9
                    "endfor",//10
                    "do",//11
                    "operator",//12
                    "to",//13
                    "for",//14
                    "endif",//15
                    "if",//16
                    "return",//17
                    "(",//18
                    ")",//19
                    "$"//20
                  };
int t_size = sizeof(t_col)/sizeof(t_col[0]);

int parse_table[36][21]={
//0   1   2   3   4   5   6   7   8   9     10  11  12  13  14  15  16  17  18  19  20
 {0  ,0  ,0  ,1  ,4  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//0
 {0  ,0  ,2  ,0  ,4  ,0  ,0  ,0  ,0   ,0    ,8  ,0  ,0  ,0  ,0  ,19 ,0  ,0  ,0  ,33 ,0  },//1
 {0  ,3  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,32 ,0  },//2
 {5  ,0  ,2  ,0  ,0  ,0  ,0  ,0  ,0   ,4    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//3
 {0  ,0  ,0  ,0  ,0  ,3  ,0  ,6  ,3   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//4
 {0  ,0  ,2  ,0  ,4  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,-1 },//5
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,7   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//6
 {0  ,0  ,0  ,0  ,0  ,0  ,4  ,6  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//7
 {0  ,0  ,0  ,0  ,23 ,0  ,0  ,0  ,0   ,0    ,8  ,9  ,0  ,0  ,0  ,19 ,0  ,0  ,0  ,0  ,0  },//8
 {0  ,0  ,0  ,0  ,0  ,10 ,0  ,0  ,10  ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//9
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,11 ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//10
 {0  ,0  ,0  ,0  ,0  ,12 ,0  ,0  ,12  ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//11
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,13 ,14 ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//12
 {0  ,0  ,0  ,0  ,0  ,13 ,0  ,0  ,13  ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//13
 {0  ,0  ,0  ,0  ,0  ,15 ,0  ,0  ,15  ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//14
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,16   ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//15
 {0  ,0  ,0  ,0  ,0  ,17 ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//16
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,18   ,0  ,0  ,0  ,0  ,1  ,0  ,0  ,0  ,0  ,0  ,0  },//17
 {0  ,0  ,0  ,0  ,0  ,17 ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//18
 {0  ,0  ,0  ,0  ,23 ,20 ,0  ,0  ,20  ,0    ,8  ,9  ,0  ,0  ,0  ,19 ,0  ,0  ,0  ,0  ,0  },//19
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,21 ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//20
 {0  ,0  ,0  ,0  ,0  ,22 ,0  ,24 ,22  ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//21
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,8  ,0  ,0  ,0  ,0  },//22
 {0  ,0  ,0  ,0  ,0  ,27 ,0  ,24 ,27  ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//23
 {0  ,0  ,0  ,0  ,0  ,25  ,0  ,0  ,25  ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//24
 {0  ,0  ,0  ,0  ,0  ,0  ,26 ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//25
 {0  ,0  ,0  ,0  ,0  ,27 ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//26
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,28   ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//27
 {0  ,0  ,0  ,0  ,0  ,19 ,0  ,29 ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//28
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,30  ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//29
 {0  ,0  ,0  ,0  ,0  ,0  ,31 ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//30
 {0  ,0  ,0  ,0  ,0  ,19 ,0  ,0  ,0   ,0    ,0  ,9  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//31
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,2  ,0  ,0  },//32
 {0  ,0  ,0  ,0  ,0  ,34 ,0  ,0  ,34  ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  },//33
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,35 ,0  ,0  },//34
 {0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   ,0    ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,1  ,0  ,0  ,0  }//35
};


//functions
int stoi(char * a)
{
  char c;
  int i=0,val=0;
  while((c=a[i++])!='\0'){
    if((c-'0')>9||(c-'0')<0) return -1;
  //  printf("%d\n",c-'0');
    val=val*10+(c-'0');
  }
  return val;
}

int getIndex(char * a)
{
  int i;
  for(i=0;i<t_size;i++){
    if(strcmp(t_col[i],a)==0)
      return i;
    }
  //printf("\nid:%d\n",a[0]-'0');
  if(a[0]=='-'||a[0]=='>'){
    return getIndex("operator");
  }
  //identifier
  if((a[0]-'0')>9||a[0]=='_')
      return getIndex("id");
  //number
  if(stoi(a)!=-1)
    return getIndex("number");
 return -1;
}

int getNextState(int state,int index){
  return parse_table[state][index];
}



int parse(struct stack *st)
{

char *p;
int state=0;
nest.top=-1;
while(st->top!=-1){
 p = pop(st);
 if(strcmp("endfor",p)==0||strcmp("endif",p)==0)
{
   ipush(&nest,state);
 }
 if(nest.top>=0){
   if(strcmp("for",p)==0||strcmp("if",p)==0){
     state=ipop(&nest);
     continue;
   }
 }
 state = getNextState(state,getIndex(p));
 if(getIndex(p)==-1||state==0){
   printf("\n\nsyntax error near %s\n\n", p);

  printf("symbol %s\tnextstate:%d\t\tindex:%d\n",p,state,getIndex(p));
   break;
 }
printf("symbol %s\tnextstate:%d\t\tindex:%d\n",p,state,getIndex(p));
}


if(st->top==-1&&state==-1&&nest.top==-1){
  printf("Your entire code accepted\n" );
}
else{
  printf("syntax error there hence\nrejected\n" );
}
return 0;
}
